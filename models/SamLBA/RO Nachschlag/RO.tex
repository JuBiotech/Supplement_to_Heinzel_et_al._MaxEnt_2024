%& --shell-escape
\input{Header}

\begin{document}
\pagestyle{empty}

\section*{FBA}
\begin{align}\label{eq: SteadyState}
	\frac{d\vec{c}}{dt} = \vec{0} \Rightarrow  \mat{S} \cdot \vec{v} = \vec{0}.
\end{align}

\begin{align}\label{eq:FluxLimits}
	\vec{\ell} \leq \vec{v} \leq \vec{u}.
\end{align}

\begin{align}\label{eq:AdditionalInequalityConstraints}
	\mat{\tilde{C}} \cdot \vec{v} \leq \vec{\tilde{b}}.
\end{align}

\begin{align}\label{eq:constraints}\renewcommand*{\arraystretch}{\matrixLineSpacing}
	\mat{C} \vec{v} = \begin{pmatrix}[r]
		\mat{\tilde{C}} \\ 
		\mat{I_n} \\
		-\mat{I_n}
	\end{pmatrix} \vec{v} \leq \begin{pmatrix}[r] \vec{\tilde{b}} \\ \vec{u} \\ -\vec{\ell} \end{pmatrix} = \vec{b},
\end{align}
 

\begin{align}\label{eq:objective}
Z(\vec{v}) = \vec{f}^T \vec{v}.
\end{align}

Summarizing,  the following FBA problem is solved using LP:
\begin{align}\label{eq:FBALP}
	\begin{array}{rl}
		\max_{\vec{v}} & \vec{f}^T \vec{v} \\
		\text{s.t.}& \mat{S} \vec{v} = \vec{0} \\
		& \mat{C} \vec{v} \leq \vec{b}.
	\end{array}
\end{align}


\section*{Example Network}
The stoichiometric matrix of the toy network is given as: 

\begin{align}\label{eq:stoichMatrixNw}
\mat{S} = \bordermatrix{~ & v_1 & v_2  & v_3  & v_4  & v_5  & v_6 \cr
A& 1 & 1 & -2 & 0 & 1 & 0 \cr
B& 1 & -1 & 0 & 1 & 0 & 0 \cr
C& 0 & 0 & 1 & -2 & 0 & -1.77 \cr
D& 0 & -1 & 0 & 1 & -1 & 1.38 \cr}
\end{align}

The example network  has two degrees of freedom. Hence the choice of two free fluxes (e.g.\@ $v_1$ and $v_6$) defines all other fluxes and the following equation holds: 

$v_2 = 2 \cdot v_1 + (1.38 - 1.77) \cdot v_6$

$v_3 = (2 \cdot 1.38 - 1.77) \cdot v_6 + 2\cdot v_1$

$v_4 = v_1 + (1.38 - 1.77) \cdot v_6$

$v_5 = 1.38 \cdot v_6 - v_1$

 The reaction rates of the example network (Figure\,\ref{fig: toyNw}) are bounded as follows:
\begin{align}\label{eq:fluxBoundsNw}
	\begin{array}{rl}
& \begin{matrix}
 0  \le v_1,v_5  \le 10 \\
 -10 \le v_2,v_3,v_4 \le 10 \\
0  \le v_6  \le 20
\end{matrix} 
	\end{array}
\end{align}

The feasible flux space is visualized in Figure\,\ref{fig: feasibleSpace}. 

\begin{figure}[htb]
\centering
\includegraphics[width=0.75\textwidth]{SolutionSpaceToyNw.png}
\caption{Intersection of a hyperplane with the flux solution space (the uptake is fixed: $v_1=8.4$). On the axes the flux range for $v_6$ (x-axis) and $v_3$ (y-axis) are shown. Due to the interdependencies between the fluxes the flux polytope is restricted. Thus, the remaining feasible solution space is represented by the colored area. When optimizing reaction $v_6$ (x-axis), the optimal value can be read off.}
\end{figure}


For the example network the criterion of optimality might be the maximization of the flux through reaction $v_6$. Metabolite D represents an artificial biomass metabolite. 

The FBA problem is then given by:
\begin{align}\label{eq:FBAtoyNw}
	\begin{array}{r l l}
		\max_{\vec{v}} 	& Z(\vec{v}) &= \vec{v}_6\\
		\text{s.t.}	  	& \mat{S} \vec{v} &=  \vec{0} \\
				  	&  v_{1,5}  & \in[0,10] \\
					&  v_{2,3,4} & \in [-10,10] \\
					&  v_6  & \in [0, 20] \\
	\end{array}
\end{align}

Solving the LP problem yields a maximal flux of $\frac{40}{3}$ through reaction $v_6$. The optimal flux solution (given in arbitrary units) is:
\begin{align}\label{eq:optToyNw}
 \vec{v} = \frac{1}{15}(126,24,150,-102,150,200)^T
\end{align}
Comparing the optimal flux distribution with the flux bounds reveals that a further increase of the objective is hampered by $v_3$ or $v_5$, because both reactions have the maximal allowed flux. 

\end{document}